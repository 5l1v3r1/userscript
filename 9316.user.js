// ==UserScript==// @name            JIRA: Add Named Watchers// @namespace       JIRA// @include         */jira/browse/*// @description     Add an icon next to the "Watchers (view)" link, that allows easily adding watchers from a pre-enumerated list.// ==/UserScript==function runScript() {	addNamedWatchers();};window.addEventListener("load", function() { runScript() }, false);function toggleQuickAddWatchersDialog() {	var popupDiv = document.getElementById("jiraaddnamedwatchersPopup");	if(popupDiv.style.visibility == 'hidden')	{		popupDiv.style.visibility = 'visible';		var confText = document.getElementById("jiraaddnamedwatchersConfText");		confText.value = getWatchers();	}	else 	{		popupDiv.style.visibility = 'hidden';		var confDiv = document.getElementById("jiraaddnamedwatchersConf");		confDiv.style.visibility = 'hidden';	}}function getWatchers() {	var watchers = document.getElementById("jiraaddnamedwatchersWatchers");	var emptyMessage = "There are no logins defined.  Please click \"Conf\" to add.";	var confWatchersList = GM_getValue("jiraaddnamedwatchers.list");	if(confWatchersList == undefined || confWatchersList == "")	{		watchers.innerHTML = emptyMessage;		return "";	}		var logins = confWatchersList.split(/\s*,\s*/);	if(logins.length == 0) {		watchers.innerHTML = emptyMessage;		return "";	}	var watchersHtml = "";  for(var i = 0; i < logins.length; ++i)	{		watchersHtml += "  <a href=\"javascript:addWatcher('" + logins[i] + "');\" style='font-size: 10pt;'>" + logins[i] + "</a>";		if( logins.length - 1 != i ) {			watchersHtml += ", ";		}	}	watchers.innerHTML = watchersHtml;	return confWatchersList;}function saveConfiguration() {	var confText = document.getElementById("jiraaddnamedwatchersConfText");	GM_setValue("jiraaddnamedwatchers.list", confText.value);	refreshWatchers();}function showConfiguration() {}function addNamedWatchers(){  var doc = window.document;	// get the issue id	var id = document.getElementById("id").value;  // get the "View Watchers" link.  We will add an icon next to it.	var viewWatchersLink = document.getElementById("view_watchers");	var html = "";	html += "<!-- start jiraaddnamedwatchers script -->\n";  html += "<form autocomplete=\"on\" name=\"startform\" method=\"post\" action=\"/jira/secure/ManageWatchers!startWatchers.jspa\">\n";	html += "  <script language=\"JavaScript\" type=\"text/javascript\">\n";  html += "  function addWatcher(login) {\n";  html += "    if(document.getElementById(\"userNames\").value != \"\") {\n";  html += "      document.getElementById(\"userNames\").value += \",\";\n";  html += "    }\n";  html += "    document.getElementById(\"userNames\").value += login;\n";  html += "  }\n";	html += "  </script>\n";	html += "<table class='small' style='width: 200px; background-color: #F0F0F0; border: 1px solid #BBB; border-collapse: collapse; padding: 2px;'>\n";	html += "<tr><td><span id='jiraaddnamedwatchersWatchers'></span></td></tr>\n";	html += "  <input autocomplete=\"on\" name=\"id\" value=\"" + id + "\" type=\"hidden\">\n";	html += "  <tr><td><input type=\"text\" autocomplete=\"on\" name=\"userNames\" id=\"userNames\" class=\"textfield\" style=\"width: 200px;\"></td></tr>\n";	html += "<tr><td style='text-align: right;'>\n";	html += "  &nbsp;&nbsp;<img src='/jira/images/icons/bullet_creme.gif' align='absmiddle' border='0' height='8' width='8'>&nbsp;<a name='jiraaddnamedwatchersConfShow' href=\"javascript:var v=((document.getElementById('jiraaddnamedwatchersConf').style.visibility == 'hidden') ? document.getElementById('jiraaddnamedwatchersConf').style.visibility = 'visible' : document.getElementById('jiraaddnamedwatchersConf').style.visibility = 'hidden');\"><b>Conf</b></a>\n";	html += "  &nbsp;&nbsp;<img src='/jira/images/icons/bullet_creme.gif' align='absmiddle' border='0' height='8' width='8'>&nbsp;<a href='javascript:var v=document.startform.submit();' value='Add'><b>Add</b></a>\n";	html += "  &nbsp;&nbsp;<img src='/jira/images/icons/bullet_creme.gif' align='absmiddle' border='0' height='8' width='8'>&nbsp;<a href=\"javascript:var v=document.getElementById('userNames').value='';\"><b>Clear</b></a>\n";	html += "  &nbsp;&nbsp;<img src='/jira/images/icons/bullet_creme.gif' align='absmiddle' border='0' height='8' width='8'>&nbsp;<a href=\"javascript:var v=document.getElementById('jiraaddnamedwatchersPopup').style.visibility='hidden';\"><b>Close</b></a>\n";	html += "</td></tr>\n";	html += "</table>\n";	html += "<div id='jiraaddnamedwatchersConf' style='visibility: hidden; position: absolute;'>\n";	html += "<table class='small' style='width: 200px; background-color: #F0F0F0; border: 1px solid #BBB; border-collapse: collapse; padding: 2px;'>\n";	html += "  <tr><td colspan='2'>Comma seprated list of JIRA logins:</td></tr>\n";	html += "<tr>\n";	html += "<td><input type='text' id='jiraaddnamedwatchersConfText' name='userNames' id='userNames' class='textfield' style='width: 145px;'></td>\n";	html += "<img src='/jira/images/icons/bullet_creme.gif' align='absmiddle' border='0' height='8' width='8'>&nbsp;<a id='jiraaddnamedwatchersConfSave' href=\"javascript:var v=alert('Saved');\"><b>Save</b></a></td>\n";	html += "</tr>\n";	html += "</table>\n";	html += "</div>\n";	html += "<form>\n";	html += "<!-- start jiraaddnamedwatchers script -->\n";	//var element = document.evaluate('/HTML[1]/BODY[1]/TABLE[3]/TBODY[1]/TR[1]/TD[1]/TABLE[2]/TBODY[1]/TR[7]', document, null, XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;  var newElement = doc.createElement ("span");	var img = doc.createElement("img");	//img.src = "/jira/images/icons/linkext7.gif";	img.src = "/jira/images/icons/form_blue_small.gif";	img.addEventListener("click", toggleQuickAddWatchersDialog, true);	insertAfter(img, viewWatchersLink);	newElement.appendChild(img);	var popupDiv = doc.createElement("div");	popupDiv.innerHTML = html;	popupDiv.id = "jiraaddnamedwatchersPopup";	popupDiv.style.visibility = 'hidden';	popupDiv.style.position = 'absolute';	newElement.appendChild(popupDiv);	insertAfter(newElement, viewWatchersLink);	var confSave = document.getElementById("jiraaddnamedwatchersConfSave");	confSave.addEventListener("click", saveConfiguration, true);	var confShow = document.getElementById("jiraaddnamedwatchersConfShow");	confSave.addEventListener("click", showConfiguration, true);}function insertAfter(newNode, target) {    var parent = target.parentNode;    var refChild = target.nextSibling;    if(refChild != null)parent.insertBefore(newNode, refChild);    elseparent.appendChild(newNode);};//.user.js