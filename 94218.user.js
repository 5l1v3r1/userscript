// ==UserScript==// @name          OkCupid Enhanced Match Results// @description	  load profile thumbnails into match search results and filter results by reply rate// @include       http://www.okcupid.com/*// @include       https://www.okcupid.com/*// @version       0.3.1// @require       http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js// ==/UserScript==var match_results = document.getElementById('match_results');var txt = '';var greenState = 1;var yellowState = 1;var redState = 1;var greyState = 1;// loads the profile imagesfunction loadImages(userID,thisDivID) {	// get imagesfrom profile	var thumbsPage = 'http://www.okcupid.com/profile/' + userID + ' #thumb0 img';	// insert into this page	$(thisDivID).find('.user_image').after('<div class="newThumbs"></div>');	$(thisDivID).find('.newThumbs').append('<span class="newThumb0"></span>');	$(thisDivID).find('.newThumb0').load(thumbsPage);	var thumbsPage = 'http://www.okcupid.com/profile/' + userID + '?cf=regular' + ' #thumb1 img';	$(thisDivID).find('.newThumbs').append('<span class="newThumb1"></span>');	$(thisDivID).find('.newThumb1').load(thumbsPage);	var thumbsPage = 'http://www.okcupid.com/profile/' + userID + '?cf=regular' + ' #thumb2 img';	$(thisDivID).find('.newThumbs').append('<span class="newThumb2"></span>');	$(thisDivID).find('.newThumb2').load(thumbsPage);		// remove the original thumbnail image	$(thisDivID).find('.user_image').remove();	}// handle the cookesfunction createCookie(name,value,days) {	if (days) {		var date = new Date();		date.setTime(date.getTime()+(days*24*60*60*1000));		var expires = "; expires="+date.toGMTString();	}	else var expires = "";	document.cookie = name+"="+value+expires+"; path=/";}function readCookie(name) {	var nameEQ = name + "=";	var ca = document.cookie.split(';');	for(var i=0;i < ca.length;i++) {		var c = ca[i];		while (c.charAt(0)==' ') c = c.substring(1,c.length);		if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);	}	return null;}/*function eraseCookie(name) {	createCookie(name,"",-1);}*/// changes variable statefunction flipState(color) {	switch(color) {		case 'green':			if(greenState==1) { 				greenState=0; 			} else { 				greenState=1; 			}			createCookie('greenState',greenState,30);			break;		case 'yellow':			if(yellowState==1) { 				yellowState=0; 			} else { 				yellowState=1; 			}			createCookie('yellowState',yellowState,30);			break;		case 'red':			if(redState==1) { 				redState=0; 			} else { 				redState=1; 			}			createCookie('redState',redState,30);			break;		case 'grey':			if(greyState==1) { 				greyState=0; 			} else { 				greyState=1; 			}			createCookie('greyState',greyState,30);			break;	}	}// checks or unchecksfunction flipChecks(color) {	switch(color) {		case 'green':			if(greenState==1) {				document.getElementById('showGreenInput').checked = true;			} else { 				document.getElementById('showGreenInput').checked = false;			}			break;		case 'yellow':			if(yellowState==1) { 				document.getElementById('showYellowInput').checked = true;			} else { 				document.getElementById('showYellowInput').checked = false;			}			break;		case 'red':			if(redState==1) { 				document.getElementById('showRedInput').checked = true;			} else { 				document.getElementById('showRedInput').checked = false;			}			break;		case 'grey':			if(greyState==1) { 				document.getElementById('showGreyInput').checked = true;			} else { 				document.getElementById('showGreyInput').checked = false;			}			break;	}}// shows or hides usersfunction flipUsers(color) {	var allDivs = match_results.getElementsByTagName('div');	// for each div on the page	for (var i = 0; i < allDivs.length; i++) {		var thisDiv = allDivs[i];		if(thisDiv.id) {				// if the div contains a user results			if(thisDiv.id.indexOf('usr-') > -1) {				var thisDivID = '#' + thisDiv.id;						switch(color) {					case 'green':						if($(thisDivID).find('.match-perc-stoplight-green').attr('style') == '') {							if(greenState == 1) {								$(thisDivID).attr('style','display:block;')	;							} else {								$(thisDivID).attr('style','display:none;');							}						}						break;					case 'yellow':						if($(thisDivID).find('.match-perc-stoplight-yellow').attr('style') == '') {							if(yellowState == 1) {								$(thisDivID).attr('style','display:block;')	;							} else {								$(thisDivID).attr('style','display:none;');							}						}						break;					case 'red':						if($(thisDivID).find('.match-perc-stoplight-red').attr('style') == '') {							if(redState == 1) {								$(thisDivID).attr('style','display:block;')	;							} else {								$(thisDivID).attr('style','display:none;');							}						}						break;					case 'grey':						if($(thisDivID).find('.uncontacted_notice').attr('style') == '') {							if(greyState == 1) {								$(thisDivID).attr('style','display:block;')	;							} else {								$(thisDivID).attr('style','display:none;');							}						}						break;				}			}		}	}}// match results pageif (match_results) {	//create a style sheet and class to make new thumbs smaller	txt =  '<style type="text/css">';	txt += '.newThumbs IMG { width:120px; height:120px; margin-left:5px; margin-bottom:5px; }';	txt += '.showUsers { border:2px solid grey; background-color:#999999; margin:5px; padding:0px; float:left; }';	txt += '#showGreen { border-color:green; background-color:#99FF99; }';	txt += '#showYellow { border-color:yellow; background-color:#FFFF99; }';	txt += '#showRed { border-color:red; background-color:#FF9999; }';	txt += '</style>';	$('#match_results').after(txt);		// for each div on the page	var allDivs = match_results.getElementsByTagName('div');	for (var i = 0; i < allDivs.length; i++) { 		var thisDiv = allDivs[i];		if(thisDiv.id) {				// if the div contains a user results			if(thisDiv.id.indexOf('usr-') > -1) {				// closure				(function() {					var userID = thisDiv.id.substring(4,thisDiv.id.length);					var thisDivID = '#' + thisDiv.id;					// remove the link from the image					$(thisDivID).find('.user_image').attr({						href: '#'					});					// add click event to the image					$(thisDivID).find('.user_image').click(function() {						loadImages(userID,thisDivID); return false;;					});				})();				// add roll-over effect to the image				var thisDivID = '#' + thisDiv.id;				$(thisDivID).find('.user_image').mouseenter(function() {					$(this).attr('style','margin-right:50px; margin-bottom:50px; cursor:e-resize;');				}).mouseleave(function() {					$(this).attr('style','');				});			}		}	   	}		// add reply rate filtering buttons	txt =  '<div id="showGreen" class="showUsers"><input id="showGreenInput" type="checkbox" name="showGreen" value="green" checked="checked" /></div>';	txt += '<div id="showYellow" class="showUsers"><input id="showYellowInput" type="checkbox" name="showYellow" value="yellow" checked="checked" /></div>';	txt += '<div id="showRed" class="showUsers"><input id="showRedInput" type="checkbox" name="showRed" value="red" checked="checked" /></div>';	txt += '<div id="showGrey" class="showUsers"><input id="showGreyInput" type="checkbox" name="showGrey" value="grey" checked="checked" /></div>';	$('.upper_section').find('h3').after(txt);	// add click events		$('#showGreen').click(function() {		flipState('green');		flipChecks('green');		flipUsers('green');	});	$('#showYellow').click(function() {		flipState('yellow');		flipChecks('yellow');		flipUsers('yellow');	});	$('#showRed').click(function() {		flipState('red');		flipChecks('red');		flipUsers('red');	});	$('#showGrey').click(function() {		flipState('grey');		flipChecks('grey');		flipUsers('grey');	});		// set initial page state	var temp;	temp = readCookie('greenState');	if(temp) { 		greenState = temp; 		flipChecks('green');		flipUsers('green');	}	temp = readCookie('yellowState');	if(temp) { 		yellowState = temp; 		flipChecks('yellow');		flipUsers('yellow');	}	temp = readCookie('redState');	if(temp) { 		redState = temp; 		flipChecks('red');		flipUsers('red');		}	temp = readCookie('greyState');	if(temp) { 		greyState = temp; 		flipChecks('grey');		flipUsers('grey');	}}